{% extends 'base/fix-nav-fluid.html' %}
{% load util_tag %}
{% block content %}
    {% include 'base/message.html' %}
    <h3 class="text-center mt-2">合同清单</h3>
    <div class=" mb-2 d-print-none">
    <a href="{% url 'contracts:contract_add' project.id %}" class="btn btn-primary mt-2 mb-2"><i class="fa fa-plus" aria-hidden="true"></i> 新增合同</a>
    <a href="{% url 'projects:project_detail' project.id %}" class="btn btn-info mt-2 mb-2"><i class="fa fa-info-circle" aria-hidden="true"></i> 项目详情</a>
    <a href="{% url 'contracts:contract_list' project.id %}" class="btn btn-info mt-2 mb-2"><i class="fa fa-compress" aria-hidden="true"></i> 折叠显示</a>
    </div>
    {% if quantity == 0 %}
        <p><b>{{ project.name }}</b>还没有合同，请新增合同。</p>
    {% else %}
            <p><small>{{ project.name }} </small></p>

        <div class="table-responsive-lg">
            <table class="table table-sm table-hover">
                <thead>
                <tr>
                    <th scope="col">合同编号</th>
                    <th scope="col">合同名称</th>
                    <th scope="col">供应商</th>
                    <th scope="col">合同总价</th>
                    <th scope="col">预算条目</th>
{#                    <th scope="col">合同收款</th>#}
                    <th scope="col">合同付款</th>
                    <th scope="col">应付余额</th>
                    <th scope="col" class="d-print-none">操作</th>
                </tr>
                </thead>
                <tbody>
                {% for contract in contracts %}
                    <tr>
                        <th scope="row"><a href="{{ contract.get_absolute_url }}">{{ contract.contract_id }}</a>
                        </th>
                        <td title="{{ contract.contract_name}}">
                            {{ contract.contract_name }}
                        </td>
                        <td title="{{ contract.contract_primary}}">{{ contract.contract_primary}}</td>
                        <td>{{ contract.contract_price|comma}}</td>
                        <td>{{ contract.contract_budget.cost_type }}</td>
{#                    合同收款#}
{#                        <td><a href="{% url 'settlements:settlement_list' contract.id %}">{{ contract.cal_total_cash_in|comma }}</a></td>#}
                        <td><a href="{% url 'settlements:settlement_payment_list' contract.id %}">{{ contract.cal_total_cash_out|comma }}</a></td>
                        <td>{{ contract.accounts_payable_balance|comma }}</td>
                        <td class="d-print-none text-nowrap"><a href="{% url 'entry:contract_entry_list' contract.id %}">明细
                        {% if contract.is_net_cash_loss %}
                            <span class="badge badge-danger">现金流</span>
                        {% endif %}</a>
                        {% if contract.is_overpaid %}
                            <span class="badge badge-danger">超付</span>
                        {% endif %}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}
{% endblock %}